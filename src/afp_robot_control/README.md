 # AFP Robot Control Package

## ğŸ“¦ åŒ…ç®€ä»‹

UR5eæœºå™¨äººç¬›å¡å°”ç©ºé—´é˜»æŠ—æ§åˆ¶åŒ…ï¼Œæ”¯æŒä½ç½®æ§åˆ¶ã€åŠ›æ§åˆ¶å’ŒæŸ”é¡ºæ§åˆ¶ã€‚

---

## ğŸ“š æ–‡æ¡£å¯¼èˆª

- **[å¿«é€Ÿå¼€å§‹](QUICKSTART.md)** â­ 5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹
- **[ROSæ¥å£è¯´æ˜](ROS_INTERFACE.md)** â­â­â­ è½¨è¿¹è§„åˆ’æ¥å£
- **[æµ‹è¯•è¯´æ˜](tests/README.md)** - è¯¦ç»†æµ‹è¯•æ–‡æ¡£
- **[ç¤ºä¾‹ä»£ç ](examples/README.md)** - å·¥å…·å’Œç¤ºä¾‹
- **[æ§åˆ¶å™¨è¯¦è§£](IMPEDANCE_CONTROLLER_README.md)** - åŸç†å’Œå‚æ•°
- **[é¡¹ç›®ç»“æ„](PROJECT_STRUCTURE.md)** - å®Œæ•´é¡¹ç›®ç»“æ„
- **[é¡¹ç›®æ€»ç»“](PROJECT_SUMMARY.md)** - å¼€å‘å†å²

---

## ğŸ“ ç›®å½•ç»“æ„

```
afp_robot_control/
â”œâ”€â”€ src/                          # æ ¸å¿ƒæºä»£ç 
â”‚   â”œâ”€â”€ impedance_control/       # é˜»æŠ—æ§åˆ¶æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ controller.py        # ç¬›å¡å°”é˜»æŠ—æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ robot_kinematics_wrapper.py  # æœºå™¨äººè¿åŠ¨å­¦
â”‚   â”‚   â”œâ”€â”€ state.py            # çŠ¶æ€å®šä¹‰
â”‚   â”‚   â””â”€â”€ strategy.py         # æ§åˆ¶ç­–ç•¥
â”‚   â”œâ”€â”€ core/                    # åŸºç¡€æ¨¡å—
â”‚   â”œâ”€â”€ ros/                     # ROSæ¥å£
â”‚   â””â”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚
â”œâ”€â”€ scripts/                      # ROSèŠ‚ç‚¹è„šæœ¬
â”‚   â”œâ”€â”€ cartesian_impedance_controller_node.py  # ç¬›å¡å°”é˜»æŠ—æ§åˆ¶èŠ‚ç‚¹
â”‚   â”œâ”€â”€ impedance_controller.py               # å…³èŠ‚ç©ºé—´é˜»æŠ—æ§åˆ¶èŠ‚ç‚¹
â”‚   â””â”€â”€ impedance_feeder_node.py             # è½¨è¿¹è¾“å…¥èŠ‚ç‚¹
â”‚
â”œâ”€â”€ tests/                        # æµ‹è¯•ç¨‹åº
â”‚   â”œâ”€â”€ force_control_impedance.py  # âœ¨ åŠ›æ§åˆ¶+é˜»æŠ—æµ‹è¯•
â”‚   â”œâ”€â”€ position_control_only.py    # âœ¨ çº¯ä½ç½®æ§åˆ¶æµ‹è¯•
â”‚   â”œâ”€â”€ test_06_pure_position.py   # ä½ç½®æ§åˆ¶åŸºç¡€æµ‹è¯•
â”‚   â”œâ”€â”€ test_07_smooth_trajectory.py  # å¹³æ»‘è½¨è¿¹æµ‹è¯•
â”‚   â””â”€â”€ test_08_torque_control.py    # åŠ›çŸ©æ§åˆ¶æµ‹è¯•
â”‚
â”œâ”€â”€ examples/                     # ç¤ºä¾‹ä»£ç 
â”‚   â”œâ”€â”€ check_kinematics.py      # è¿åŠ¨å­¦éªŒè¯å·¥å…·
â”‚   â””â”€â”€ force_sensor_filter.py   # åŠ›ä¼ æ„Ÿå™¨æ»¤æ³¢ç¤ºä¾‹
â”‚
â”œâ”€â”€ archived/                     # å†å²è°ƒè¯•æ–‡ä»¶
â”‚   â””â”€â”€ test_*.py               # æ—©æœŸæµ‹è¯•ç¨‹åº
â”‚
â”œâ”€â”€ config/                       # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ impedance_controller_default.yaml
â”‚   â””â”€â”€ afp_task_config.yaml
â”‚
â”œâ”€â”€ launch/                       # Launchæ–‡ä»¶
â”‚   â”œâ”€â”€ cartesian_impedance_controller.launch
â”‚   â””â”€â”€ hardware_drivers.launch
â”‚
â””â”€â”€ msg/                         # æ¶ˆæ¯å®šä¹‰
    â”œâ”€â”€ ImpedanceParams.msg
    â””â”€â”€ JointPositionCommand.msg
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è¿è¡Œæ ¸å¿ƒæµ‹è¯•

#### åŠ›æ§åˆ¶æµ‹è¯•ï¼ˆæ¨èï¼‰
```bash
cd tests
python3 force_control_impedance.py
```
- æµ‹è¯•é˜»æŠ—æ§åˆ¶ + æ¥è§¦åŠ›æ§åˆ¶
- ä¸‰é˜¶æ®µè½¨è¿¹ï¼šæ¥è¿‘ â†’ æ¥è§¦ â†’ XYå¹³é¢è¿åŠ¨
- ç›®æ ‡æ¥è§¦åŠ›ï¼š-10N

#### çº¯ä½ç½®æ§åˆ¶æµ‹è¯•
```bash
cd tests
python3 position_control_only.py
```
- æµ‹è¯•çº¯ä½ç½®è·Ÿè¸ªï¼ˆæ— åŠ›æ§åˆ¶ï¼‰
- éªŒè¯åŸºç¡€è¿åŠ¨å­¦æ§åˆ¶
- å§¿æ€ä¿æŒæµ‹è¯•

### 2. è¿è¡ŒROSèŠ‚ç‚¹

#### å¯åŠ¨é˜»æŠ—æ§åˆ¶å™¨
```bash
roslaunch afp_robot_control cartesian_impedance_controller.launch
```

#### å‘å¸ƒå‚è€ƒè½¨è¿¹ï¼ˆä½ éœ€è¦å®ç°ï¼‰
```python
# ç¤ºä¾‹ï¼šå‘å¸ƒå›ºå®šä½ç½®
import rospy
from geometry_msgs.msg import PoseStamped

rospy.init_node('my_trajectory')
pub = rospy.Publisher('/reference_trajectory', PoseStamped, queue_size=10)

msg = PoseStamped()
msg.pose.position.x = 0.5
msg.pose.position.y = 0.0
msg.pose.position.z = 0.4
msg.pose.orientation.w = 1.0
pub.publish(msg)
```

**è¯¦ç»†è¯´æ˜**: å‚è§ [ROSæ¥å£æ–‡æ¡£](ROS_INTERFACE.md)

#### å¯åŠ¨å®Œæ•´ç³»ç»Ÿ
```bash
roslaunch afp_robot_control hardware_drivers.launch
```

## ğŸ“– æ ¸å¿ƒåŠŸèƒ½

### é˜»æŠ—æ§åˆ¶å™¨

**ç‰¹ç‚¹**ï¼š
- ç¬›å¡å°”ç©ºé—´6Dé˜»æŠ—æ§åˆ¶
- æ”¯æŒä½ç½®æ§åˆ¶å’ŒåŠ›æ§åˆ¶æ··åˆ
- é‡åŠ›è¡¥å¿
- å¤šç§æ§åˆ¶ç­–ç•¥ï¼ˆStandard/AFPï¼‰

**å…³é”®å‚æ•°**ï¼š
```python
# ä½ç½®åˆšåº¦ [X, Y, Z] (N/m)
position_stiffness = [500, 500, 50]

# ä½ç½®é˜»å°¼ [X, Y, Z] (NÂ·s/m)
position_damping = [50, 50, 15]

# å§¿æ€åˆšåº¦ [Rx, Ry, Rz] (NÂ·m/rad)
orientation_stiffness = [50, 50, 50]

# å§¿æ€é˜»å°¼ [Rx, Ry, Rz] (NÂ·mÂ·s/rad)
orientation_damping = [10, 10, 10]
```

### è¿åŠ¨å­¦æ±‚è§£å™¨

**åŠŸèƒ½**ï¼š
- æ­£è¿åŠ¨å­¦ï¼ˆPinocchioï¼‰
- é€†è¿åŠ¨å­¦ï¼ˆCLIK + é˜»å°¼æœ€å°äºŒä¹˜ï¼‰
- é›…å¯æ¯”è®¡ç®—
- åŠ¨åŠ›å­¦è®¡ç®—ï¼ˆé‡åŠ›/ç§‘æ°åŠ›ï¼‰

**IKå‚æ•°**ï¼š
```python
controller.robot_kin.set_ik_parameters(
    eps=1e-3,           # æ”¶æ•›é˜ˆå€¼
    max_iter=500,       # æœ€å¤§è¿­ä»£æ¬¡æ•°
    damping=1e-4,       # é˜»å°¼ç³»æ•°
    position_only=False # 6D IK
)
```

## ğŸ§ª æµ‹è¯•è¯´æ˜

### tests/ ç›®å½•æµ‹è¯•

| æµ‹è¯•æ–‡ä»¶ | åŠŸèƒ½ | é‡è¦æ€§ |
|---------|------|-------|
| `force_control_impedance.py` | æ¥è§¦åŠ›æ§åˆ¶ + é˜»æŠ— | â­â­â­ ä¸»è¦ |
| `position_control_only.py` | çº¯ä½ç½®è·Ÿè¸ª | â­â­â­ åŸºå‡† |
| `test_06_pure_position.py` | ä½ç½®æ§åˆ¶åŸºç¡€ | â­â­ å‚è€ƒ |
| `test_07_smooth_trajectory.py` | è½¨è¿¹ç”Ÿæˆ | â­â­ å‚è€ƒ |
| `test_08_torque_control.py` | åŠ›çŸ©æ§åˆ¶ | â­â­ å‚è€ƒ |

### è¿è¡Œè¦æ±‚

**ç¯å¢ƒ**ï¼š
- Python 3.8+
- MuJoCo 3.3.7+
- Pinocchio 3.8.0+

**åœºæ™¯æ–‡ä»¶**ï¼š
```
/home/lgx/Project/AFP/src/afp_mjc/env/mujoco_ur5e/
â”œâ”€â”€ scene_contact.xml  # å¸¦æ¥è§¦æ¡Œé¢çš„åœºæ™¯
â”œâ”€â”€ scene.xml          # åŸºç¡€åœºæ™¯
â””â”€â”€ ur5e.urdf          # UR5e URDF
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### ä½ç½®æ§åˆ¶ç²¾åº¦
- é™æ€è¯¯å·®ï¼š< 2mm
- åŠ¨æ€è·Ÿè¸ªï¼š< 5mm
- å§¿æ€åå·®ï¼š< 2Â°

### åŠ›æ§åˆ¶æ€§èƒ½
- æ¥è§¦åŠ›ç¨³æ€è¯¯å·®ï¼šÂ± 2N
- å“åº”æ—¶é—´ï¼š< 1s
- åŠ›æ§æ–¹å‘ï¼šZè½´ï¼ˆæ³•å‘ï¼‰

### æ§åˆ¶é¢‘ç‡
- MuJoCoä»¿çœŸï¼š500 Hz
- å®é™…æœºå™¨äººï¼š125 Hz (UR5eé™åˆ¶)

## ğŸ”§ å¸¸è§é—®é¢˜

### Q: IKæ±‚è§£å¤±è´¥ï¼Ÿ
**A**: æ£€æŸ¥ç›®æ ‡ä½å§¿æ˜¯å¦åœ¨å·¥ä½œç©ºé—´å†…ï¼Œè°ƒæ•´`eps`å’Œ`damping`å‚æ•°ã€‚

### Q: é˜»æŠ—æ§åˆ¶éœ‡è¡ï¼Ÿ
**A**: é™ä½åˆšåº¦å‚æ•°æˆ–å¢åŠ é˜»å°¼æ¯”ã€‚å»ºè®®ä»ä½åˆšåº¦å¼€å§‹è°ƒè¯•ã€‚

### Q: æ¥è§¦åŠ›ä¸ç¨³å®šï¼Ÿ
**A**: 
1. ç¡®è®¤æ¡Œé¢é«˜åº¦é…ç½®æ­£ç¡®
2. ä½¿ç”¨å¹³æ»‘åŠ›è¿‡æ¸¡ï¼ˆ1ç§’æ¸å˜ï¼‰
3. è°ƒæ•´æ¥è§¦å¼¹æ€§å‚æ•°ï¼ˆsolref/solimpï¼‰

### Q: é‡åŠ›è¡¥å¿è¯¯å·®å¤§ï¼Ÿ
**A**: ç¡®è®¤ä½¿ç”¨äº†`pinocchio.computeGeneralizedGravity`å¹¶æ­£ç¡®é…ç½®`kp_joints`ã€‚

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é˜»æŠ—æ§åˆ¶å™¨è¯¦ç»†è¯´æ˜](IMPEDANCE_CONTROLLER_README.md)
- [MuJoCoæµ‹è¯•æŒ‡å—](MUJOCO_TEST_GUIDE.md) - å·²è¿‡æ—¶ï¼Œå‚è€ƒæœ¬æ–‡æ¡£
- [é¡¹ç›®æ€»ç»“](PROJECT_SUMMARY.md)
- [CMakeé…ç½®è¯´æ˜](CMAKE_SETUP.md)

## ğŸ¯ æ ¸å¿ƒæµ‹è¯•å·¥ä½œæµ

### å¼€å‘æ–°åŠŸèƒ½çš„æ¨èæµç¨‹

1. **åŸºç¡€éªŒè¯** â†’ `position_control_only.py`
   - ç¡®è®¤ä½ç½®è·Ÿè¸ªæ­£å¸¸
   - éªŒè¯è¿åŠ¨å­¦è®¡ç®—æ­£ç¡®

2. **æ·»åŠ åŠ›æ§åˆ¶** â†’ `force_control_impedance.py`
   - åœ¨ä½ç½®æ§åˆ¶åŸºç¡€ä¸Šæ·»åŠ é˜»æŠ—
   - æµ‹è¯•æ¥è§¦åœºæ™¯

3. **å®é™…åº”ç”¨** â†’ ROSèŠ‚ç‚¹
   - ä½¿ç”¨éªŒè¯è¿‡çš„å‚æ•°
   - è¿æ¥å®é™…ç¡¬ä»¶

## ğŸ“ å¼€å‘è€…æ³¨æ„äº‹é¡¹

### é‡è¦æç¤º
1. **æµ‹è¯•å‰å…ˆè·‘ä½ç½®æ§åˆ¶**ï¼šç¡®ä¿åŸºç¡€åŠŸèƒ½æ­£å¸¸
2. **åŠ›æ§åˆ¶è¦ç¼“æ…¢æ¥è§¦**ï¼šä½¿ç”¨å¹³æ»‘è¿‡æ¸¡é¿å…å†²å‡»
3. **ä¿æŒä½åˆšåº¦èµ·æ­¥**ï¼šè°ƒè¯•æ—¶ä»æŸ”é¡ºå‚æ•°å¼€å§‹
4. **ç›‘æ§å§¿æ€åå·®**ï¼šæ¥è§¦æ—¶å®¹æ˜“äº§ç”Ÿå§¿æ€å˜åŒ–

### ä»£ç è§„èŒƒ
- æµ‹è¯•æ–‡ä»¶æ”¾åœ¨ `tests/` ç›®å½•
- å·¥å…·å‡½æ•°æ”¾åœ¨ `examples/` ç›®å½•  
- å†å²ä»£ç ç§»åˆ° `archived/` ç›®å½•
- ROSèŠ‚ç‚¹æ”¾åœ¨ `scripts/` ç›®å½•

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä¸ºAFPå®éªŒå®¤å†…éƒ¨ä½¿ç”¨ã€‚

## ğŸ‘¥ ç»´æŠ¤è€…

AFP Lab - UR5eæ§åˆ¶å›¢é˜Ÿ
