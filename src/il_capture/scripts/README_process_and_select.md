# HDF5 数据可视化与筛选工具 - 使用说明

## 新增功能

### 1. 执行器末端位姿可视化
- **红色轨迹**：机械臂末端原始位置
- **粉色轨迹**：机械臂末端平滑位置
- **蓝色轨迹**：执行器末端原始位置
- **青色轨迹**：执行器末端平滑位置
- **红色球体**：当前帧的机械臂末端位置
- **蓝色球体**：当前帧的执行器末端位置

执行器末端位置根据机械臂末端位姿和偏移量 `[0, 0, 0.237]` 计算得出。

### 2. 力传感器数据可视化
- 实时显示 XYZ 三个方向的力数据
- 同时展示原始数据（透明线条）和平滑后的数据（粗实线）
- 黑色圆点标记当前时间步的力值

### 3. 数据平滑处理
使用 Savitzky-Golay 滤波器对以下数据进行平滑：
- 机械臂末端位置
- 执行器末端位置
- 力传感器数据

平滑参数可在代码中调整（`window_length=11`, `polyorder=3`）

### 4. 选择数据保存
- 选择的演示数据保存到新的 HDF5 文件（文件名后缀为 `_selected.hdf5`）
- 保存统计信息：保留、删除、未决的演示数量

## 操作说明

### 键盘控制
- **→ / ←**：前进/后退一帧
- **Space**：播放/暂停自动播放
- **Y**：标记当前演示为"保留"
- **N**：标记当前演示为"删除"
- **ESC**：退出程序

### 窗口说明
- **Open3D 窗口**：显示点云和轨迹
- **Matplotlib 窗口**：显示力传感器数据（如果有）

## 使用示例

```python
from process_and_select import DataInspector

# 创建检查器实例
inspector = DataInspector(
    h5_path="path/to/your/data.hdf5",
    voxel_size=0.01,      # 点云体素下采样大小
    play_dt=0.05,         # 自动播放时每帧间隔（秒）
    ee_offset=[0, 0, 0.237]  # 执行器末端偏移量
)

# 开始检查
inspector.run()
```

## 数据要求

HDF5 文件应包含以下字段：
- **必需**：
  - `robot0_eef_pos`: 机械臂末端位置 (T, 3)
  - `pointcloud`: 点云数据 (T, N, 6)
  
- **可选**：
  - `robot0_eef_quat`: 机械臂末端四元数 (T, 4) - 用于精确计算执行器末端位置
  - `robot0_eef_force`: 力传感器数据 (T, 3) - 用于力数据可视化

如果缺少 `robot0_eef_quat`，程序将假设无旋转，简单地将偏移量添加到机械臂末端位置。

## 输出

程序完成后会生成：
- `原文件名_selected.hdf5`：包含所有标记为"保留"的演示数据
- 控制台输出：显示保留/删除/未决的演示数量

## 注意事项

1. 执行器末端位置的计算依赖于正确的四元数格式（x, y, z, w）
2. 平滑处理可能会在轨迹端点处产生边界效应
3. 如果数据帧数太少（< 5），平滑功能会自动降级或跳过
4. 力传感器图表会在关闭 Open3D 窗口后自动关闭
